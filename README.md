<p align="center">
    <a href="https://github.com/CICDToolbox">
        <img src="https://cdn.wolfsoftware.com/assets/images/github/organisations/cicdtoolbox/black-and-white-circle-256.png" alt="CICDToolbox Logo" />
    </a>
    <br />
    <a href="https://github.com/CICDToolbox/yaml-lint/actions/workflows/pipeline.yml">
        <img src="https://img.shields.io/github/workflow/status/CICDToolbox/yaml-lint/pipeline/master?style=for-the-badge" alt="Github Build Status">
    </a>
    <a href="https://github.com/CICDToolbox/yaml-lint/releases/latest">
        <img src="https://img.shields.io/github/v/release/CICDToolbox/yaml-lint?color=blue&label=Latest%20Release&style=for-the-badge" alt="Release">
    </a>
    <a href="https://github.com/CICDToolbox/yaml-lint/releases/latest">
        <img src="https://img.shields.io/github/commits-since/CICDToolbox/yaml-lint/latest.svg?color=blue&style=for-the-badge" alt="Commits since release">
    </a>
    <br />
    <a href=".github/CODE_OF_CONDUCT.md">
        <img src="https://img.shields.io/badge/Code%20of%20Conduct-blue?style=for-the-badge" />
    </a>
    <a href=".github/CONTRIBUTING.md">
        <img src="https://img.shields.io/badge/Contributing-blue?style=for-the-badge" />
    </a>
    <a href=".github/SECURITY.md">
        <img src="https://img.shields.io/badge/Report%20Security%20Concern-blue?style=for-the-badge" />
    </a>
    <a href="https://github.com/CICDToolbox/yaml-lint/issues">
        <img src="https://img.shields.io/badge/Get%20Support-blue?style=for-the-badge" />
    </a>
    <br />
    <a href="https://wolfsoftware.com">
        <img src="https://img.shields.io/badge/Created%20by%20Wolf%20Software-blue?style=for-the-badge" />
    </a>
</p>

## Overview

A tool to lint your yaml files in CI/CD pipelines using [yamllint](https://pypi.org/project/yamllint/).

This tool has been written and tested using GitHub Actions but it should work out of the box with a lot of other CI/CD tools.

## Usage

```yml
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Ruby 3.0
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.0
      - name: Run YAML-Lint
        run: bash <(curl -s https://raw.githubusercontent.com/CICDToolbox/yaml-lint/master/pipeline.sh)
```

### Other Options

The following environment variables can be set in order to customise the script.

| Name          | Purpose | Default Value |
| ------------- | ------- | ------------- |
| EXCLUDE_FILES | A comma separated list of files to exclude from being scanned. You can also use `regex` to do pattern matching. | Unset |
| REPORT_ONLY   | Generate the report but do not fail the build even if an error occurred. | False | 
| SHOW_ERRORS   | Show the actual errors instead of just which files had errors. | True | 
| SHOW_SKIPPED  | Show which files are being skipped. | False | 

You can use any combination of the above settings.

```yml
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Ruby 3.0
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.0
      - name: Run YAML-Lint
        env:
          REPORT_ONLY: true
          SHOW_ERRORS: true
        run: bash <(curl -s https://raw.githubusercontent.com/CICDToolbox/yaml-lint/master/pipeline.sh)
```

### Example Output

This is an example of the output report generated by this tool, this is the actual output from the tool running against itself.
```
-------------------------------------------------------------------------- Stage 1 - Parameters --
 No parameters given
--------------------------------------------------------------- Stage 2 - Install Prerequisites --
 [  OK  ] gem install --quiet yaml-lint
------------------------------------------------------------- Stage 3 - Run yaml-lint (v0.0.10) --
 [  OK  ] .github/FUNDING.yml
 [  OK  ] .github/ISSUE_TEMPLATE/ask_question.yml
 [  OK  ] .github/ISSUE_TEMPLATE/bug_report.yml
 [  OK  ] .github/ISSUE_TEMPLATE/config.yml
 [  OK  ] .github/ISSUE_TEMPLATE/feature_request.yml
 [  OK  ] .github/workflows/pipeline.yml
 [  OK  ] stale.yml
------------------------------------------------------------------------------ Stage 4 - Report --
 Total: 7, OK: 7, Failed: 0, Skipped: 0
---------------------------------------------------------------------------- Stage 5 - Complete --
```

### File Identification

Yaml files are identified using the following code:

```shell
[[ ${filename} =~ \.(yml|yaml)$ ]]
```
> There is not magic type for yaml files so file -b is of not use for identifying the files.

## Yamllint Defaults

This is a pre-defined configuration named relaxed. As its name suggests, it is more tolerant:

```shell
---
extends: default

rules:
  braces:
    level: warning
    max-spaces-inside: 1
  brackets:
    level: warning
    max-spaces-inside: 1
  colons:
    level: warning
  commas:
    level: warning
  comments: disable
  comments-indentation: disable
  document-start: disable
  empty-lines:
    level: warning
  hyphens:
    level: warning
  indentation:
    level: warning
    indent-sequences: consistent
  line-length:
    level: warning
    allow-non-breakable-inline-mappings: true
  truthy: disable
```
